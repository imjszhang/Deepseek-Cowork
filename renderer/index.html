<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' blob: file: https: data:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https: blob:; style-src 'self' 'unsafe-inline' https: blob: file:; font-src 'self' https: data:; img-src 'self' data: blob: file: https:; connect-src 'self' http://localhost:3333 ws://localhost:8080 https:; frame-src blob: file: https:;">
  <title>DeepSeek Cowork</title>
  <!-- æœ¬åœ°å­—ä½“: Inter + JetBrains Mono -->
  <link rel="stylesheet" href="fonts/fonts.css">
  <!-- åŸºç¡€æ ·å¼ -->
  <link rel="stylesheet" href="css/base/reset.css">
  <link rel="stylesheet" href="css/base/variables.css">
  <!-- ä¸»æ ·å¼ -->
  <link rel="stylesheet" href="css/main.css">
  <!-- å¸ƒå±€æ ·å¼ -->
  <link rel="stylesheet" href="css/layout/titlebar.css">
  <link rel="stylesheet" href="css/layout/sidebar.css">
  <link rel="stylesheet" href="css/layout/panel.css">
  <link rel="stylesheet" href="css/layout/statusbar.css">
  <link rel="stylesheet" href="css/icons.css">
  <!-- ç»„ä»¶æ ·å¼ -->
  <link rel="stylesheet" href="css/components/button.css">
  <link rel="stylesheet" href="css/components/badge.css">
  <link rel="stylesheet" href="css/components/card.css">
  <link rel="stylesheet" href="css/components/dialog.css">
  <link rel="stylesheet" href="css/components/message.css">
  <link rel="stylesheet" href="css/components/file-preview.css">
  <link rel="stylesheet" href="css/components/file-item.css">
  <link rel="stylesheet" href="css/components/glass.css">
  <link rel="stylesheet" href="css/components/tabs.css">
  <link rel="stylesheet" href="css/components/browser-panel.css">
  <link rel="stylesheet" href="css/components/input.css">
  <link rel="stylesheet" href="css/components/todo.css">
  <link rel="stylesheet" href="css/components/wizard.css">
  <link rel="stylesheet" href="css/components/dropdown.css">
  <link rel="stylesheet" href="css/components/connection-guide.css">
  <link rel="stylesheet" href="css/components/session-hub.css">
  <!-- å·¥å…·ç±»æ ·å¼ -->
  <link rel="stylesheet" href="css/utilities/animations.css">
  <link rel="stylesheet" href="css/utilities/scrollbar.css">
  <link rel="stylesheet" href="css/utilities/responsive.css">
  <!-- Highlight.js ä»£ç é«˜äº®ä¸»é¢˜ (ç”± ThemeManager åŠ¨æ€åˆ‡æ¢) -->
  <link id="hljs-theme" rel="stylesheet" href="css/highlight-js-atom-one-light.min.css">
  <!-- Three.js 3D å›¾å½¢åº“ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <!-- PDF.js - æŒ‰éœ€åŠ è½½ï¼Œé¿å… ES module é˜»å¡žé—®é¢˜ -->
  <script>
    // PDF.js å»¶è¿ŸåŠ è½½å‡½æ•°ï¼ˆåªåœ¨éœ€è¦æ—¶åŠ è½½ï¼‰
    window.loadPdfJs = function() {
      if (window.pdfjsLibPromise) {
        return window.pdfjsLibPromise;
      }
      window.pdfjsLibPromise = import('https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.min.mjs')
        .then(pdfjs => {
          pdfjs.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.worker.min.mjs';
          window.pdfjsLib = pdfjs;
          console.log('[PDF.js] Loaded successfully');
          return pdfjs;
        })
        .catch(error => {
          console.error('[PDF.js] Failed to load:', error);
          window.pdfjsLibPromise = null;
          throw error;
        });
      return window.pdfjsLibPromise;
    };
  </script>
</head>
<body>
  <div id="app">
    <!-- æžç®€æ ‡é¢˜æ  - è·¨å¹³å°ä¸€è‡´ -->
    <header id="titlebar">
      <!-- macOS äº¤é€šç¯æŒ‰é’®å ä½åŒº (ä»… macOS æ˜¾ç¤º) -->
      <div id="titlebar-macos-controls" class="titlebar-section">
        <button id="close-btn" class="window-btn macos close" data-i18n-title="titlebar.close" title="Close">
          <span class="btn-icon-inner"></span>
        </button>
        <button id="minimize-btn" class="window-btn macos minimize" data-i18n-title="titlebar.minimize" title="Minimize">
          <span class="btn-icon-inner"></span>
        </button>
        <button id="maximize-btn" class="window-btn macos maximize" data-i18n-title="titlebar.maximize" title="Maximize">
          <span class="btn-icon-inner"></span>
        </button>
      </div>
      
      <!-- ä¸­é—´æ‹–æ‹½åŒº + äº§å“ä¿¡æ¯ -->
      <div id="titlebar-center" class="titlebar-section">
        <div id="product-info" class="product-info">
          <span class="product-name">DeepSeek Cowork</span>
          <span class="product-version" id="product-version">V0.1.0</span>
        </div>
      </div>
      
      <!-- Windows/Linux çª—å£æŽ§åˆ¶æŒ‰é’® (ä»… Win/Linux æ˜¾ç¤º) -->
      <div id="titlebar-win-controls" class="titlebar-section">
        <button id="minimize-btn-win" class="window-btn win" data-i18n-title="titlebar.minimize" title="Minimize">
          <svg width="10" height="1" viewBox="0 0 10 1"><rect width="10" height="1" fill="currentColor"/></svg>
        </button>
        <button id="maximize-btn-win" class="window-btn win" data-i18n-title="titlebar.maximize" title="Maximize">
          <svg width="10" height="10" viewBox="0 0 10 10"><rect width="10" height="10" fill="none" stroke="currentColor" stroke-width="1"/></svg>
        </button>
        <button id="close-btn-win" class="window-btn win close" data-i18n-title="titlebar.close" title="Close">
          <svg width="10" height="10" viewBox="0 0 10 10"><line x1="0" y1="0" x2="10" y2="10" stroke="currentColor" stroke-width="1.2"/><line x1="10" y1="0" x2="0" y2="10" stroke="currentColor" stroke-width="1.2"/></svg>
        </button>
      </div>
    </header>
    
    <!-- ä¸»å®¹å™¨ï¼šå¯¼èˆªæ  + å¯¹è¯æ¡† + å±•ç¤ºæ  -->
    <div id="main-container" class="chat-fullwidth">
      <!-- Left sidebar navigation -->
      <nav id="sidebar">
        <div class="nav-section">
          <button class="nav-btn active" data-panel="chat" data-i18n-title="sidebar.chat" title="Chat">
            <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg></span>
            <span class="nav-label" data-i18n="sidebar.chat">Chat</span>
          </button>
          <button class="nav-btn" data-panel="files" data-i18n-title="sidebar.fileManagement" title="File Management">
            <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/></svg></span>
            <span class="nav-label" data-i18n="sidebar.files">Files</span>
          </button>
          <button class="nav-btn" data-panel="browser" data-i18n-title="sidebar.browserManagement" title="Browser Management">
            <span class="nav-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg></span>
            <span class="nav-label" data-i18n="sidebar.browser">Browser</span>
          </button>
        </div>
        <div class="nav-spacer"></div>
        <div class="nav-section">
          <button class="nav-btn" data-panel="settings" data-i18n-title="settings.title" title="Settings">
            <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg></span>
            <span class="nav-label" data-i18n="sidebar.settings">Settings</span>
          </button>
        </div>
      </nav>
      
      <!-- Chat panel -->
      <section id="chat-panel">
        <!-- Three.js åŠ¨æ€èƒŒæ™¯ç‹¬ç«‹å±‚ï¼ˆæ— æ¶ˆæ¯æ—¶æ˜¾ç¤ºï¼Œä½œä¸ºAIå¯¹è¯é¦–é¡µï¼‰ -->
        <div id="chat-threejs-bg" class="chat-threejs-bg">
          <!-- é¦–é¡µå†…å®¹å®¹å™¨ -->
          <div class="chat-home-content">
            <div class="chat-home-header">
              <h2 class="chat-home-title" data-i18n="chat.homeTitle">What can I help you with?</h2>
            </div>
            <div class="chat-home-input-container">
              <textarea id="chat-home-input" class="chat-home-input" data-i18n-placeholder="chat.homeInputPlaceholder" placeholder="Describe what you want to do..." rows="4"></textarea>
              <button id="chat-home-send-btn" class="chat-home-send-btn" data-i18n-title="chat.send" title="Send" disabled>
                <svg viewBox="0 0 24 24"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
              </button>
            </div>
          </div>
        </div>
        <!-- Chat panel header with Session Hub button -->
        <div class="chat-panel-header">
          <div class="chat-header-left">
            <!-- Reserved for future use -->
          </div>
          <div class="chat-header-right">
            <button id="session-hub-btn" class="chat-header-btn" data-i18n-title="sessionHub.title" title="Session Hub">
              <svg viewBox="0 0 24 24"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
            </button>
          </div>
        </div>
        <div id="ai-chat-container">
          <div id="ai-messages">
            <div class="ai-welcome">
              <h3 data-i18n="chat.welcomeTitle">Welcome to DeepSeek Cowork</h3>
              <p data-i18n="chat.welcomeDesc">After connecting, you can chat with DeepSeek Cowork to perform tasks</p>
            </div>
          </div>
          <!-- ä¸Šä¸‹æ–‡ä½¿ç”¨é‡çŠ¶æ€æ  -->
          <div id="ai-context-bar" class="context-bar" style="display: none;">
            <div class="context-info">
              <span class="context-tokens">
                <span class="token-label">Input:</span>
                <span id="context-input-tokens">-</span>
                <span class="token-divider">|</span>
                <span class="token-label">Output:</span>
                <span id="context-output-tokens">-</span>
              </span>
              <span class="context-model" id="context-model">
                <span class="model-badge" id="context-model-name">-</span>
              </span>
              <span id="context-remaining" class="context-remaining">
                <span id="context-percent">-</span>
              </span>
            </div>
            <div class="context-progress">
              <div class="context-fill" id="context-fill"></div>
            </div>
          </div>
          <div id="ai-input-area">
            <textarea id="ai-input" data-i18n-placeholder="chat.inputPlaceholder" placeholder="Enter message..." rows="1"></textarea>
            <button id="ai-abort-btn" class="abort-btn" data-i18n-title="chat.abort" title="Abort (Esc)" style="display: none;">
              <span class="abort-icon"><svg viewBox="0 0 24 24"><rect width="14" height="14" x="5" y="5" rx="2"/></svg></span>
            </button>
            <button id="ai-send-btn" class="send-btn" data-i18n-title="chat.send" title="Send" disabled>
              <svg viewBox="0 0 24 24"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
            </button>
          </div>
        </div>
      </section>
      
      <!-- å±•ç¤ºæ  -->
      <main id="display-panel">
        <!-- Browser panel -->
        <div id="panel-browser" class="panel">
          <!-- ç§»åŠ¨ç‰ˆé¡¶éƒ¨å¯¼èˆªæ  -->
          <div class="display-panel-header" id="browser-panel-header">
            <div class="display-header-left">
              <h3 class="display-header-title" data-i18n="sidebar.browser">Browser</h3>
            </div>
            <div class="display-header-right">
              <button class="display-header-btn mobile-drawer-toggle" data-drawer="browser" data-i18n-title="browser.toggleMenu" title="Toggle Menu">
                <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/><path d="M9 3v6"/></svg>
              </button>
            </div>
          </div>
          <div class="panel-content browser-panel-no-header" id="browser-panel-content">
            <!-- åˆ†æ å®¹å™¨ï¼ˆrow-reverseï¼šå±•ç¤ºåŒºåœ¨å·¦ï¼Œèœå•æ åœ¨å³ï¼‰ -->
            <div id="browser-split-container" class="browser-split-container">
              <!-- å³ä¾§ï¼šèœå•æ ï¼ˆä½œä¸ºä¾§è¾¹æ ï¼‰ -->
              <div id="browser-menu-pane" class="browser-menu-pane">
                <div class="browser-menu-header">
                  <h3 data-i18n="browser.title">Browser</h3>
                  <button id="refresh-tabs-btn" class="browser-menu-action" data-i18n-title="browser.refreshTabs" title="Refresh Tab List">
                    <svg viewBox="0 0 24 24" width="14" height="14"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                  </button>
                </div>
                <div class="browser-menu-list">
                  <div class="browser-menu-item active" data-view="tabs">
                    <span class="menu-icon"><svg viewBox="0 0 24 24" width="16" height="16"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/><path d="M9 3v6"/></svg></span>
                    <span class="menu-label" data-i18n="browser.activeTabs">Active Tabs</span>
                    <span class="menu-badge" id="tabs-count-badge">0</span>
                  </div>
                </div>
              </div>
              
              <!-- åˆ†æ æ‹–æ‹½æ¡ -->
              <div id="browser-resizer" class="browser-resizer"></div>
              
              <!-- å·¦ä¾§ï¼šå±•ç¤ºåŒºï¼ˆä¸»è§†è§‰åŒºåŸŸï¼‰ -->
              <div id="browser-display-pane" class="browser-display-pane">
                <!-- Three.js åŠ¨æ€èƒŒæ™¯å®¹å™¨ï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰ -->
                <div id="browser-threejs-bg" class="browser-threejs-bg"></div>
                <!-- æ ‡ç­¾é¡µå†…å®¹å®¹å™¨ï¼ˆé»˜è®¤éšè—ï¼Œæœ‰æ ‡ç­¾æ—¶æ˜¾ç¤ºï¼‰ -->
                <div id="browser-content-container" class="browser-content-container" style="display: none;">
                  <div id="tabs-grid" class="tabs-grid">
                    <!-- Tabs will be added dynamically -->
                  </div>
                </div>
                <!-- ç©ºçŠ¶æ€ï¼ˆé»˜è®¤æ˜¾ç¤ºï¼Œæœ‰æ ‡ç­¾æ—¶éšè—ï¼‰ -->
                <div id="no-tabs-message" class="browser-empty-state">
                  <span class="empty-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg></span>
                  <p data-i18n="browser.noTabs">No open tabs</p>
                  <p class="empty-hint" data-i18n="browser.noTabsHint">Please ensure the browser extension is installed and connected</p>
                </div>
                <!-- åŠ è½½çŠ¶æ€ -->
                <div id="loading-overlay" class="browser-loading-overlay" style="display: none;">
                  <div class="loading-spinner"></div>
                  <p class="loading-text" data-i18n="common.loading">Loading...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- File panel -->
        <div id="panel-files" class="panel active">
          <!-- ç§»åŠ¨ç‰ˆé¡¶éƒ¨å¯¼èˆªæ  -->
          <div class="display-panel-header" id="files-panel-header">
            <div class="display-header-left">
              <h3 class="display-header-title" data-i18n="sidebar.files">Files</h3>
            </div>
            <div class="display-header-right">
              <button class="display-header-btn mobile-drawer-toggle" data-drawer="files" data-i18n-title="files.toggleList" title="Toggle File List">
                <svg viewBox="0 0 24 24"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/></svg>
              </button>
            </div>
          </div>
          <div class="panel-content files-panel-no-header" id="files-panel-content">
            <!-- åˆ†æ å®¹å™¨ï¼ˆrow-reverseï¼šé¢„è§ˆåŒºåœ¨å·¦ï¼Œæ–‡ä»¶åˆ—è¡¨åœ¨å³ï¼‰ -->
            <div id="files-split-container" class="files-split-container">
              <!-- å³ä¾§ï¼šæ–‡ä»¶åˆ—è¡¨é¢æ¿ï¼ˆä½œä¸ºä¾§è¾¹æ ï¼‰ -->
              <div id="files-list-pane" class="files-list-pane">
                <!-- ç´§å‡‘é¢åŒ…å±‘å¯¼èˆªï¼ˆç”±JavaScriptåŠ¨æ€æ¸²æŸ“ï¼‰ -->
                <div id="files-breadcrumb" class="breadcrumb breadcrumb-compact"></div>
                <!-- File list container -->
                <div id="files-container">
                  <div id="files-list"></div>
                  <div id="files-loading" class="loading-state" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p data-i18n="common.loading">Loading...</p>
                  </div>
                  <div id="no-files-message" class="empty-state" style="display: none;">
                    <span class="empty-icon"><svg viewBox="0 0 24 24"><path d="m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"/></svg></span>
                    <p data-i18n="files.emptyFolder">Folder is empty</p>
                    <p class="empty-hint" data-i18n="files.emptyFolderHint">Click "New Folder" button to create a folder</p>
                  </div>
                  <div id="files-error" class="error-state" style="display: none;">
                    <span class="error-icon"><svg viewBox="0 0 24 24"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg></span>
                    <p id="files-error-message" data-i18n="files.loadFailed">Load Failed</p>
                  </div>
                </div>
              </div>
              
              <!-- åˆ†æ æ‹–æ‹½æ¡ -->
              <div id="files-resizer" class="files-resizer"></div>
              
              <!-- å·¦ä¾§ï¼šæ–‡ä»¶é¢„è§ˆé¢æ¿ï¼ˆä¸»è§†è§‰åŒºåŸŸï¼‰ -->
              <div id="file-preview-pane" class="file-preview-pane">
                <!-- Three.js åŠ¨æ€èƒŒæ™¯å®¹å™¨ -->
                <div id="preview-threejs-bg" class="preview-threejs-bg"></div>
                <!-- æ–‡ä»¶é¢„è§ˆ/ç¼–è¾‘é¢æ¿ -->
                <div id="file-preview-container" class="file-preview-container" style="display: none;">
                  <!-- å¤šæ–‡ä»¶æ ‡ç­¾æ  -->
                  <div id="file-tabs-bar" class="file-tabs-bar">
                    <div class="file-tabs-scroll" id="file-tabs-scroll">
                      <!-- æ ‡ç­¾é¡µå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                  </div>
                  <div class="file-preview-header">
                    <span class="file-preview-title">
                      <span class="preview-icon" id="preview-icon">ðŸ“„</span>
                      <span id="preview-filename">filename.txt</span>
                    </span>
                    <div class="file-preview-actions">
                      <!-- è§†å›¾åˆ‡æ¢æŒ‰é’®ï¼ˆä»… HTML/Markdown æ–‡ä»¶æ˜¾ç¤ºï¼‰ -->
                      <div id="preview-view-toggle" class="preview-view-toggle" style="display: none;">
                        <button id="preview-source-btn" class="view-toggle-btn active" data-i18n-title="explorer.preview.sourceView" title="Source">
                          <svg viewBox="0 0 24 24" width="14" height="14"><path d="m18 16 4-4-4-4"/><path d="m6 8-4 4 4 4"/><path d="m14.5 4-5 16"/></svg>
                        </button>
                        <button id="preview-render-btn" class="view-toggle-btn" data-i18n-title="explorer.preview.renderedView" title="Preview">
                          <svg viewBox="0 0 24 24" width="14" height="14"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg>
                        </button>
                      </div>
                      <button id="preview-edit-btn" data-i18n="explorer.preview.edit">Edit</button>
                      <button id="preview-save-btn" style="display: none;" data-i18n="explorer.preview.save">Save</button>
                      <button id="preview-cancel-btn" style="display: none;" data-i18n="common.cancel">Cancel</button>
                      <button id="preview-close-btn" data-i18n="explorer.preview.close">Close</button>
                    </div>
                  </div>
                  <div class="file-preview-content" id="file-preview-content">
                    <pre id="file-preview-code"><code></code></pre>
                    <textarea id="file-edit-area" style="display: none;"></textarea>
                    <!-- HTML æ¸²æŸ“é¢„è§ˆ iframe -->
                    <iframe id="file-preview-iframe" class="file-preview-iframe" style="display: none;"></iframe>
                    <!-- Markdown æ¸²æŸ“é¢„è§ˆå®¹å™¨ -->
                    <div id="markdown-preview" class="markdown-preview" style="display: none;"></div>
                  </div>
                  <div class="file-preview-status">
                    <span id="preview-file-size"></span>
                    <span id="preview-file-modified"></span>
                    <span id="preview-unsaved" style="display: none;" data-i18n="explorer.preview.unsaved">Unsaved</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- File context menu -->
        <div id="file-context-menu" class="context-menu" style="display: none;">
          <div class="context-menu-item" data-action="open">
            <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"/></svg></span>
            <span data-i18n="files.open">Open</span>
          </div>
          <div class="context-menu-item" data-action="openWith">
            <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M15 3h6v6"/><path d="M10 14 21 3"/><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/></svg></span>
            <span data-i18n="files.openWith">Open with System App</span>
          </div>
          <div class="context-menu-divider"></div>
          <div class="context-menu-item" data-action="rename">
            <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"/><path d="m15 5 4 4"/></svg></span>
            <span data-i18n="files.rename">Rename</span>
          </div>
          <div class="context-menu-item" data-action="showInExplorer">
            <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/></svg></span>
            <span data-i18n="files.showInExplorer">Show in File Manager</span>
          </div>
          <div class="context-menu-divider"></div>
          <div class="context-menu-item context-menu-danger" data-action="delete">
            <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg></span>
            <span data-i18n="files.delete">Delete</span>
          </div>
        </div>
        
        <!-- Empty area context menu -->
        <div id="empty-area-context-menu" class="context-menu" style="display: none;">
          <div class="context-menu-item" data-action="newFile">
            <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="12" x2="12" y1="18" y2="12"/><line x1="9" x2="15" y1="15" y2="15"/></svg></span>
            <span data-i18n="files.newFile">New File</span>
          </div>
          <div class="context-menu-item" data-action="newFolder">
            <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="12" x2="12" y1="11" y2="17"/><line x1="9" x2="15" y1="14" y2="14"/></svg></span>
            <span data-i18n="files.newFolder">New Folder</span>
          </div>
        </div>
        
        <!-- New folder dialog -->
        <div id="new-folder-dialog" class="modal-overlay" style="display: none;">
          <div class="modal-dialog">
            <div class="modal-header">
              <h3 data-i18n="files.newFolderDialog.title">New Folder</h3>
              <button class="modal-close-btn" id="new-folder-cancel-btn">Ã—</button>
            </div>
            <div class="modal-body">
              <label for="new-folder-name" data-i18n="files.newFolderDialog.label">Folder Name</label>
              <input type="text" id="new-folder-name" data-i18n-placeholder="files.newFolderDialog.placeholder" placeholder="Enter folder name..." autofocus>
              <p id="new-folder-error" class="input-error" style="display: none;"></p>
            </div>
            <div class="modal-footer">
              <button class="button btn-secondary" data-variant="outline" id="new-folder-cancel-btn2" data-i18n="common.cancel">Cancel</button>
              <button class="button btn-primary" data-variant="default" id="new-folder-create-btn" data-i18n="files.newFolderDialog.create">Create</button>
            </div>
          </div>
        </div>
        
        <!-- New file dialog -->
        <div id="new-file-dialog" class="modal-overlay" style="display: none;">
          <div class="modal-dialog">
            <div class="modal-header">
              <h3 data-i18n="files.newFileDialog.title">New File</h3>
              <button class="modal-close-btn" id="new-file-cancel-btn">Ã—</button>
            </div>
            <div class="modal-body">
              <label for="new-file-name" data-i18n="files.newFileDialog.label">File Name</label>
              <input type="text" id="new-file-name" data-i18n-placeholder="files.newFileDialog.placeholder" placeholder="Enter file name..." autofocus>
              <p id="new-file-error" class="input-error" style="display: none;"></p>
            </div>
            <div class="modal-footer">
              <button class="button btn-secondary" data-variant="outline" id="new-file-cancel-btn2" data-i18n="common.cancel">Cancel</button>
              <button class="button btn-primary" data-variant="default" id="new-file-create-btn" data-i18n="files.newFileDialog.create">Create</button>
            </div>
          </div>
        </div>
        
        <!-- Rename dialog -->
        <div id="rename-dialog" class="modal-overlay" style="display: none;">
          <div class="modal-dialog">
            <div class="modal-header">
              <h3 data-i18n="files.renameDialog.title">Rename</h3>
              <button class="modal-close-btn" id="rename-cancel-btn">Ã—</button>
            </div>
            <div class="modal-body">
              <label for="rename-input" data-i18n="files.renameDialog.label">New Name</label>
              <input type="text" id="rename-input" data-i18n-placeholder="files.renameDialog.placeholder" placeholder="Enter new name..." autofocus>
              <p id="rename-error" class="input-error" style="display: none;"></p>
            </div>
            <div class="modal-footer">
              <button class="button btn-secondary" data-variant="outline" id="rename-cancel-btn2" data-i18n="common.cancel">Cancel</button>
              <button class="button btn-primary" data-variant="default" id="rename-confirm-btn" data-i18n="common.confirm">Confirm</button>
            </div>
          </div>
        </div>
        
        <!-- Welcome setup dialog -->
        <div id="welcome-setup-dialog" class="modal-overlay welcome-setup-overlay" style="display: none;">
          <div class="modal-dialog welcome-setup-dialog">
            <div class="modal-header">
              <h3 data-i18n="dialogs.welcomeSetup.title">Setup Agent</h3>
            </div>
            <div class="modal-body welcome-setup-body">
              <p class="welcome-description" data-i18n="dialogs.welcomeSetup.description">
                To use Agent features, you need to configure API Secret.
              </p>
              <div class="welcome-options">
                <button class="welcome-option-btn" id="btn-create-account">
                  <span class="option-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg></span>
                  <div class="option-content">
                    <span class="option-title" data-i18n="dialogs.welcomeSetup.createNew">Create New Account</span>
                    <span class="option-desc" data-i18n="dialogs.welcomeSetup.createNewDesc">Generate a new Secret Key and start using</span>
                  </div>
                </button>
                <button class="welcome-option-btn" id="btn-import-secret">
                  <span class="option-icon"><svg viewBox="0 0 24 24"><path d="m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4"/><path d="m21 2-9.6 9.6"/><circle cx="7.5" cy="15.5" r="5.5"/></svg></span>
                  <div class="option-content">
                    <span class="option-title" data-i18n="dialogs.welcomeSetup.useExisting">Use Existing Secret Key</span>
                    <span class="option-desc" data-i18n="dialogs.welcomeSetup.useExistingDesc">Enter your existing Secret Key to recover account</span>
                  </div>
                </button>
              </div>
              <p class="welcome-skip-hint">
                <a href="#" id="btn-skip-setup" data-i18n="dialogs.welcomeSetup.skipSetup">Setup Later</a><span data-i18n="dialogs.welcomeSetup.skipHint">(Some features will not be available)</span>
              </p>
            </div>
          </div>
        </div>
        
        <!-- Secret Key backup dialog -->
        <div id="secret-backup-dialog" class="modal-overlay" style="display: none;">
          <div class="modal-dialog secret-backup-dialog">
            <div class="modal-header">
              <h3><svg viewBox="0 0 24 24" width="20" height="20" style="display:inline;vertical-align:middle;margin-right:8px;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;fill:none;"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg><span data-i18n="dialogs.secretBackup.title">Your Secret Key</span></h3>
            </div>
            <div class="modal-body">
              <div class="backup-warning">
                <span class="warning-icon"><svg viewBox="0 0 24 24"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg></span>
                <div class="warning-content">
                  <strong data-i18n="dialogs.secretBackup.importantNotice">Important Notice</strong>
                  <p data-i18n="dialogs.secretBackup.backupWarning">This is the only way to recover your account, please save it in a safe place!</p>
                </div>
              </div>
              <div class="secret-display-container">
                <code id="secret-display" class="secret-display"></code>
                <button id="btn-copy-secret" class="btn-copy" data-i18n-title="dialogs.secretBackup.copyToClipboard" title="Copy to Clipboard">
                  <svg viewBox="0 0 24 24"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg> <span data-i18n="common.copy">Copy</span>
                </button>
              </div>
              <p id="copy-status" class="copy-status" style="display: none;"></p>
              <div class="backup-confirm">
                <label class="checkbox-label">
                  <input type="checkbox" id="backup-confirmed">
                  <span data-i18n="dialogs.secretBackup.confirmSaved">I have saved the Secret Key in a safe place</span>
                </label>
              </div>
            </div>
            <div class="modal-footer">
              <button class="button btn-secondary" data-variant="outline" id="btn-backup-cancel" data-i18n="common.cancel">Cancel</button>
              <button class="button btn-primary" data-variant="default" id="btn-backup-continue" disabled data-i18n="dialogs.secretBackup.confirmContinue">Confirm and Continue</button>
            </div>
          </div>
        </div>
        
        <!-- Secret Key input dialog -->
        <div id="secret-input-dialog" class="modal-overlay" style="display: none;">
          <div class="modal-dialog secret-input-dialog">
            <div class="modal-header">
              <h3><svg viewBox="0 0 24 24" width="20" height="20" style="display:inline;vertical-align:middle;margin-right:8px;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;fill:none;"><path d="m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4"/><path d="m21 2-9.6 9.6"/><circle cx="7.5" cy="15.5" r="5.5"/></svg><span data-i18n="dialogs.secretInput.title">Enter Secret Key</span></h3>
              <button class="modal-close-btn" id="secret-input-close-btn">Ã—</button>
            </div>
            <div class="modal-body">
              <p class="input-hint" data-i18n="dialogs.secretInput.formatHint">
                Supported formats:
              </p>
              <ul class="format-list">
                <li data-i18n="dialogs.secretInput.formatSegmented">Segmented format: XXXXX-XXXXX-XXXXX-...</li>
                <li data-i18n="dialogs.secretInput.formatBase64">Base64URL format</li>
              </ul>
              <div class="secret-input-container">
                <textarea id="secret-input-field" 
                          class="secret-input-field" 
                          data-i18n-placeholder="dialogs.secretInput.placeholder"
                          placeholder="Enter or paste Secret Key..."
                          rows="3"></textarea>
              </div>
              <p id="secret-input-status" class="input-status"></p>
            </div>
            <div class="modal-footer">
              <button class="button btn-secondary" data-variant="outline" id="btn-secret-input-cancel" data-i18n="common.cancel">Cancel</button>
              <button class="button btn-primary" data-variant="default" id="btn-secret-input-verify" disabled data-i18n="dialogs.secretInput.verifyLogin">Verify and Login</button>
            </div>
          </div>
        </div>
        
        <!-- Setup complete dialog -->
        <div id="setup-complete-dialog" class="modal-overlay" style="display: none;">
          <div class="modal-dialog setup-complete-dialog">
            <div class="modal-header">
              <h3><svg viewBox="0 0 24 24" width="20" height="20" style="display:inline;vertical-align:middle;margin-right:8px;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;fill:none;"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg><span data-i18n="dialogs.setupComplete.title">Setup Complete</span></h3>
            </div>
            <div class="modal-body">
              <div class="success-icon"><svg viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg></div>
              <p class="success-message" data-i18n="dialogs.setupComplete.message">Your account has been configured successfully!</p>
              <p class="success-hint" data-i18n="dialogs.setupComplete.hint">Setup complete, you can start using now.</p>
            </div>
            <div class="modal-footer">
              <button class="button btn-primary" data-variant="default" id="btn-setup-complete" data-i18n="dialogs.setupComplete.startUsing">Start Using</button>
            </div>
          </div>
        </div>
        
        <!-- Change server dialog -->
        <div id="change-server-dialog" class="modal-overlay" style="display: none;">
          <div class="modal-dialog change-server-dialog">
            <div class="modal-header">
              <h3><svg viewBox="0 0 24 24" width="20" height="20" style="display:inline;vertical-align:middle;margin-right:8px;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;fill:none;"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg><span data-i18n="dialogs.changeServer.title">Change Server Address</span></h3>
            </div>
            <div class="modal-body">
              <div class="setting-item">
                <label data-i18n="dialogs.changeServer.currentServer">Current Server</label>
                <input type="text" id="current-server-display" readonly class="muted">
              </div>
              <div class="setting-item">
                <label data-i18n="dialogs.changeServer.newServer">New Server Address</label>
                <input type="text" id="new-server-input" data-i18n-placeholder="dialogs.changeServer.newServerPlaceholder" placeholder="e.g.: api.deepseek-cowork.com">
                <p class="setting-hint" data-i18n="dialogs.changeServer.newServerHint">Leave empty to use default server (api.deepseek-cowork.com)</p>
              </div>
              <div class="warning-box">
                <p class="warning-title"><svg viewBox="0 0 24 24" width="16" height="16" style="display:inline;vertical-align:middle;margin-right:4px;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;fill:none;"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg><span data-i18n="dialogs.changeServer.warning">Warning</span></p>
                <p class="warning-text" data-i18n="dialogs.changeServer.warningText">Changing server will:</p>
                <ul class="warning-list">
                  <li data-i18n="dialogs.changeServer.warningLogout">Logout current account</li>
                  <li data-i18n="dialogs.changeServer.warningClearData">Clear all session data and chat history</li>
                  <li data-i18n="dialogs.changeServer.warningReconfigure">Require reconfiguring API Secret</li>
                </ul>
              </div>
            </div>
            <div class="modal-footer">
              <button class="button btn-secondary" data-variant="outline" id="btn-change-server-cancel" data-i18n="common.cancel">Cancel</button>
              <button class="button btn-danger" data-variant="destructive" id="btn-change-server-confirm" data-i18n="dialogs.changeServer.confirmChange">Confirm Change</button>
            </div>
          </div>
        </div>
        
        <!-- Settings panel -->
        <div id="panel-settings" class="panel">
          <!-- ç§»åŠ¨ç‰ˆé¡¶éƒ¨å¯¼èˆªæ ï¼ˆè®¾ç½®é¢æ¿ä½¿ç”¨å·¦ä¾§æŠ½å±‰ï¼‰ -->
          <div class="display-panel-header" id="settings-panel-header">
            <div class="display-header-left">
              <h3 class="display-header-title" data-i18n="settings.title">Settings</h3>
            </div>
            <div class="display-header-right">
              <button class="display-header-btn mobile-drawer-toggle" data-drawer="settings" data-drawer-side="right" data-i18n-title="settings.toggleNav" title="Toggle Navigation">
                <svg viewBox="0 0 24 24"><path d="M3 12h18"/><path d="M3 6h18"/><path d="M3 18h18"/></svg>
              </button>
            </div>
          </div>
          <div class="panel-header settings-desktop-header">
            <h2 data-i18n="settings.title">Settings</h2>
          </div>
          <div class="panel-content settings-split-layout">
            <!-- å·¦ä¾§ï¼šè®¾ç½®åˆ†ç±»å¯¼èˆª -->
            <nav class="settings-nav" id="settings-nav">
              <div class="settings-nav-item active" data-section="environment">
                <span class="nav-icon"><svg viewBox="0 0 24 24" width="16" height="16"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M7 7h.01"/><path d="M17 7h.01"/><path d="M7 17h.01"/><path d="M17 17h.01"/></svg></span>
                <span data-i18n="settings.environment">Environment</span>
              </div>
              <div class="settings-nav-item" data-section="claude-code">
                <span class="nav-icon"><svg viewBox="0 0 24 24" width="16" height="16"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg></span>
                <span data-i18n="settings.claudeCodeConfig">Claude Code</span>
              </div>
              <div class="settings-nav-item" data-section="account">
                <span class="nav-icon"><svg viewBox="0 0 24 24" width="16" height="16"><circle cx="12" cy="8" r="5"/><path d="M20 21a8 8 0 0 0-16 0"/></svg></span>
                <span data-i18n="settings.accountManagement">Account</span>
              </div>
              <div class="settings-nav-item" data-section="conversation">
                <span class="nav-icon"><svg viewBox="0 0 24 24" width="16" height="16"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg></span>
                <span data-i18n="settings.conversationSettings">Conversation</span>
              </div>
              <div class="settings-nav-item" data-section="appearance">
                <span class="nav-icon"><svg viewBox="0 0 24 24" width="16" height="16"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg></span>
                <span data-i18n="settings.appearance">Appearance</span>
              </div>
              <div class="settings-nav-item" data-section="server">
                <span class="nav-icon"><svg viewBox="0 0 24 24" width="16" height="16"><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg></span>
                <span data-i18n="settings.serverSettings">Server</span>
              </div>
              <div class="settings-nav-item" data-section="logs">
                <span class="nav-icon"><svg viewBox="0 0 24 24" width="16" height="16"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg></span>
                <span data-i18n="settings.logs">Logs</span>
              </div>
            </nav>
            
            <!-- å³ä¾§ï¼šè®¾ç½®å†…å®¹åŒºåŸŸ -->
            <div class="settings-content" id="settings-content">
              <!-- Environment Section -->
              <div class="settings-section active" id="settings-environment">
                <div class="settings-section-header">
                  <h3>
                    <span data-i18n="settings.environment">Environment</span>
                    <button id="btn-refresh-deps" class="btn-icon-sm" data-i18n-title="settings.refreshCheck" title="Refresh Check"><svg viewBox="0 0 24 24" width="14" height="14"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg></button>
                  </h3>
                </div>
                
                <!-- Node.js -->
                <div class="env-item" id="env-nodejs">
                  <div class="env-header">
                    <span class="env-name">Node.js</span>
                    <span class="env-badge" id="nodejs-badge" data-i18n="settings.checking">Checking...</span>
                  </div>
                  <div class="env-details" id="nodejs-details">
                    <div class="env-row">
                      <span class="env-label" data-i18n="settings.systemVersion">System Version:</span>
                      <span class="env-value" id="nodejs-version">-</span>
                    </div>
                    <div class="env-row">
                      <span class="env-label" data-i18n="settings.npmVersion">npm Version:</span>
                      <span class="env-value" id="npm-version">-</span>
                    </div>
                    <div class="env-row">
                      <span class="env-label" data-i18n="settings.electronBuiltin">Electron Built-in:</span>
                      <span class="env-value" id="electron-node-version">-</span>
                    </div>
                  </div>
                  <div class="env-actions" id="nodejs-actions" style="display: none;">
                    <button id="btn-install-nodejs" class="btn-link" data-i18n="settings.installGuide">Installation Guide</button>
                  </div>
                </div>
                
                <!-- Claude Code -->
                <div class="env-item" id="env-claude-code">
                  <div class="env-header">
                    <span class="env-name">Claude Code</span>
                    <span class="env-badge" id="claude-code-badge" data-i18n="settings.checking">Checking...</span>
                  </div>
                  <div class="env-details" id="claude-code-details">
                    <div class="env-row">
                      <span class="env-label" data-i18n="settings.version">Version:</span>
                      <span class="env-value" id="claude-code-version">-</span>
                    </div>
                    <div class="env-row">
                      <span class="env-label" data-i18n="settings.source">Source:</span>
                      <span class="env-value" id="claude-code-source">-</span>
                    </div>
                    <div class="env-row">
                      <span class="env-label" data-i18n="settings.path">Path:</span>
                      <span class="env-value env-path" id="claude-code-path" title="">-</span>
                    </div>
                  </div>
                  
                  <!-- Connection status -->
                  <div class="daemon-details" id="daemon-details">
                    <div class="daemon-header">
                      <span class="daemon-title" data-i18n="settings.connectionStatus">Connection Status</span>
                      <span class="daemon-status-badge" id="daemon-status-badge">
                        <span class="daemon-status-dot" id="daemon-status-dot"></span>
                        <span id="daemon-status-text" data-i18n="settings.checking">Checking...</span>
                      </span>
                    </div>
                    <div class="daemon-info">
                      <div class="env-row">
                        <span class="env-label" data-i18n="settings.pid">PID:</span>
                        <span class="env-value" id="daemon-pid">-</span>
                      </div>
                      <div class="env-row">
                        <span class="env-label" data-i18n="settings.port">Port:</span>
                        <span class="env-value" id="daemon-port">-</span>
                      </div>
                      <div class="env-row">
                        <span class="env-label" data-i18n="settings.startTime">Start Time:</span>
                        <span class="env-value" id="daemon-start-time">-</span>
                      </div>
                    </div>
                    <div class="daemon-controls">
                      <button id="btn-daemon-start" class="btn-daemon" data-i18n-title="common.start" title="Start">
                        <span class="btn-icon"><svg viewBox="0 0 24 24" width="12" height="12"><polygon points="6 3 20 12 6 21 6 3"/></svg></span>
                        <span class="btn-text" data-i18n="common.start">Start</span>
                      </button>
                      <button id="btn-daemon-stop" class="btn-daemon btn-danger" data-i18n-title="common.stop" title="Stop">
                        <span class="btn-icon"><svg viewBox="0 0 24 24" width="12" height="12"><rect width="14" height="14" x="5" y="5" rx="2"/></svg></span>
                        <span class="btn-text" data-i18n="common.stop">Stop</span>
                      </button>
                      <button id="btn-daemon-restart" class="btn-daemon" data-i18n-title="common.restart" title="Restart">
                        <span class="btn-icon"><svg viewBox="0 0 24 24" width="12" height="12"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg></span>
                        <span class="btn-text" data-i18n="common.restart">Restart</span>
                      </button>
                    </div>
                  </div>
                  
                  <div class="env-actions" id="claude-code-actions" style="display: none;">
                    <button id="btn-install-claude-code" class="btn-link" data-i18n="settings.installGuide">Installation Guide</button>
                  </div>
                </div>
                
                <!-- Server Status -->
                <div class="env-item" id="env-server">
                  <div class="env-header">
                    <span class="env-name" data-i18n="settings.serverStatus">Server Status</span>
                    <span class="env-badge installed" id="server-panel-badge" data-i18n="settings.running">Running</span>
                  </div>
                  <div class="env-details">
                    <!-- BrowserControl Service -->
                    <div class="server-group">
                      <div class="server-group-title">BrowserControl</div>
                      <div class="env-row">
                        <span class="env-label">HTTP:</span>
                        <span class="env-value" id="server-http-port">:3333</span>
                      </div>
                      <div class="env-row">
                        <span class="env-label">WebSocket:</span>
                        <span class="env-value" id="server-ws-port">:8080</span>
                      </div>
                      <div class="env-row">
                        <span class="env-label" data-i18n="settings.extensionConnections">Extension Connections:</span>
                        <span class="env-value" id="server-ext-count">0</span>
                      </div>
                    </div>
                    <!-- Explorer Status -->
                    <div class="server-group">
                      <div class="server-group-title">Explorer</div>
                      <div class="env-row">
                        <span class="env-label" data-i18n="settings.status">Status:</span>
                        <span class="env-value" id="server-explorer-status" data-i18n="explorer.status.offline">Offline</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Software Update -->
                <div class="env-item" id="env-update">
                  <div class="env-header">
                    <span class="env-name" data-i18n="settings.softwareUpdate">Software Update</span>
                    <span class="env-badge" id="update-badge" data-i18n="settings.upToDate">Up to Date</span>
                  </div>
                  <div class="env-details" id="update-details">
                    <div class="env-row">
                      <span class="env-label" data-i18n="settings.currentVersion">Current Version:</span>
                      <span class="env-value" id="update-current-version">-</span>
                    </div>
                    <div class="env-row" id="update-new-version-row" style="display: none;">
                      <span class="env-label" data-i18n="settings.newVersion">New Version:</span>
                      <span class="env-value" id="update-new-version">-</span>
                    </div>
                    <div class="env-row" id="update-progress-row" style="display: none;">
                      <span class="env-label" data-i18n="settings.downloadProgress">Download Progress:</span>
                      <span class="env-value" id="update-progress-text">0%</span>
                    </div>
                    <div class="update-progress-bar" id="update-progress-bar" style="display: none;">
                      <div class="update-progress-fill" id="update-progress-fill" style="width: 0%;"></div>
                    </div>
                  </div>
                  <div class="env-actions" id="update-actions">
                    <button id="btn-check-update" class="btn-primary-sm" data-i18n="settings.checkUpdate">Check for Updates</button>
                    <button id="btn-download-update" class="btn-primary-sm" style="display: none;" data-i18n="settings.downloadUpdate">Download Update</button>
                    <button id="btn-install-update" class="btn-primary-sm" style="display: none;" data-i18n="settings.installUpdate">Restart & Install</button>
                    <button id="btn-skip-update" class="btn-link" style="display: none;" data-i18n="settings.skipUpdate">Later</button>
                  </div>
                </div>
                
                <!-- Setup wizard entry -->
                <div class="env-wizard-entry">
                  <button id="btn-rerun-setup-wizard" class="btn-secondary-sm">
                    <svg viewBox="0 0 24 24" width="14" height="14" style="display:inline;vertical-align:middle;margin-right:4px;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;fill:none;"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg> <span data-i18n="settings.rerunWizard">Re-run Setup Wizard</span>
                  </button>
                  <p class="setting-hint" data-i18n="settings.rerunWizardHint">If you encounter configuration issues, you can re-run the setup wizard</p>
                </div>
              </div>
              
              <!-- Claude Code Configuration Section -->
              <div class="settings-section" id="settings-claude-code">
                <div class="settings-section-header">
                  <h3 data-i18n="settings.claudeCodeConfig">Claude Code Configuration</h3>
                </div>
                <div class="setting-item">
                  <label data-i18n="settings.apiProvider">API Provider</label>
                  <select id="claude-provider">
                    <option value="anthropic" data-i18n="settings.providerAnthropic">Anthropic (Official)</option>
                    <option value="deepseek" data-i18n="settings.providerDeepSeek">DeepSeek</option>
                    <option value="custom" data-i18n="settings.providerCustom">Custom</option>
                  </select>
                </div>
                <div class="setting-item" id="claude-baseurl-item" style="display: none;">
                  <label data-i18n="settings.apiEndpoint">API Endpoint</label>
                  <input type="text" id="claude-baseurl" placeholder="https://api.deepseek.com/anthropic">
                  <p class="setting-hint" data-i18n="settings.apiEndpointHint">Leave empty to use default endpoint</p>
                </div>
                <div class="setting-item">
                  <label data-i18n="settings.authToken">Auth Token</label>
                  <div class="secret-input-container">
                    <input type="password" id="claude-auth-token" data-i18n-placeholder="settings.tokenPlaceholder" placeholder="Enter Token...">
                    <button id="btn-toggle-claude-token" class="btn-icon" data-i18n-title="settings.showHide" title="Show/Hide">
                      <svg viewBox="0 0 24 24"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg>
                    </button>
                    <button id="btn-save-claude-token" class="btn-secondary-sm" data-i18n="common.save">Save</button>
                  </div>
                  <span id="claude-token-status" class="setting-status"></span>
                </div>
                <div class="setting-item" id="claude-model-item" style="display: none;">
                  <label data-i18n="settings.modelName">Model Name</label>
                  <input type="text" id="claude-model" placeholder="deepseek-chat">
                </div>
                <div class="setting-item">
                  <label data-i18n="settings.timeout">Timeout</label>
                  <div class="timeout-input-container">
                    <input type="number" id="claude-timeout" value="600000" min="60000" max="1800000">
                    <span class="input-suffix">ms</span>
                  </div>
                  <p class="setting-hint" data-i18n="settings.timeoutHint">Default 600000ms (10 minutes)</p>
                </div>
                <div class="setting-item setting-item-row">
                  <label data-i18n="settings.disableNonessential">Disable Non-essential Traffic</label>
                  <label class="switch">
                    <input type="checkbox" id="claude-disable-nonessential">
                    <span class="slider"></span>
                  </label>
                </div>
                <div class="setting-item">
                  <button id="btn-save-claude-settings" class="btn-secondary" data-i18n="settings.saveClaudeConfig">
                    <svg viewBox="0 0 24 24"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                    <span data-i18n="settings.saveClaudeConfig">Save Claude Code Config</span>
                  </button>
                </div>
              </div>
              
              <!-- Account Management Section -->
              <div class="settings-section" id="settings-account">
                <div class="settings-section-header">
                  <h3 data-i18n="settings.accountManagement">Account Management</h3>
                </div>
                
                <!-- Account status card -->
                <div class="account-card" id="account-card">
                  <!-- Logged in state -->
                  <div class="account-logged-in" id="account-logged-in" style="display: none;">
                    <div class="account-status-row">
                      <div class="account-status-item">
                        <span class="account-label" data-i18n="settings.status">Status</span>
                        <span class="account-value">
                          <span class="status-dot-sm connected" id="account-status-dot"></span>
                          <span id="account-status-text" data-i18n="chat.connected">Connected</span>
                        </span>
                      </div>
                      <div class="account-status-item">
                        <span class="account-label" data-i18n="settings.anonymousId">Anonymous ID</span>
                        <span class="account-value account-id-value">
                          <code id="account-anon-id">-</code>
                          <button class="btn-icon-xs" id="btn-copy-anon-id" data-i18n-title="common.copy" title="Copy"><svg viewBox="0 0 24 24"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg></button>
                        </span>
                      </div>
                    </div>
                    <div class="account-status-row">
                      <div class="account-status-item full-width">
                        <span class="account-label" data-i18n="settings.accountServer">Account Server</span>
                        <span class="account-value"><code id="account-server">-</code></span>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Not logged in state -->
                  <div class="account-not-logged-in" id="account-not-logged-in">
                    <div class="account-empty-state">
                      <span class="status-dot-sm disconnected"></span>
                      <span class="account-empty-text" data-i18n="settings.notConfigured">Not Configured</span>
                    </div>
                    <p class="account-empty-hint" data-i18n="settings.notConfiguredHint">To use Agent features, please configure your account first</p>
                    <div class="account-empty-actions">
                      <button class="btn-primary-sm" id="btn-account-create" data-i18n="settings.createAccount">Create New Account</button>
                      <button class="btn-secondary-sm" id="btn-account-import" data-i18n="settings.useExisting">Use Existing Account</button>
                    </div>
                  </div>
                </div>
                
                <!-- Backup section (shown when logged in) -->
                <div class="account-backup-section" id="account-backup-section" style="display: none;">
                  <div class="setting-item">
                    <div class="backup-header">
                      <label data-i18n="settings.secretKey">Secret Key</label>
                      <button class="btn-link" id="btn-toggle-secret-display">
                        <span id="secret-toggle-icon"><svg viewBox="0 0 24 24" width="14" height="14"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg></span>
                        <span id="secret-toggle-text" data-i18n="settings.show">Show</span>
                      </button>
                    </div>
                    <p class="setting-hint warning-hint" data-i18n="settings.secretKeyHint">This is the only credential to recover your account, please keep it safe</p>
                  </div>
                  
                  <!-- Secret display section (collapsible) -->
                  <div class="secret-display-section" id="secret-display-section" style="display: none;">
                    <div class="secret-display-box">
                      <code id="account-secret-display">-</code>
                      <button class="btn-copy-inline" id="btn-copy-secret-key" data-i18n-title="common.copy" title="Copy">
                        <svg viewBox="0 0 24 24"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg> <span data-i18n="common.copy">Copy</span>
                      </button>
                    </div>
                    <p class="copy-hint" id="secret-copy-hint" style="display: none;"></p>
                  </div>
                </div>
                
                <!-- Account actions (shown when logged in) -->
                <div class="account-actions-section" id="account-actions-section" style="display: none;">
                  <div class="account-action-buttons">
                    <button class="btn-secondary" id="btn-switch-account">
                      <svg viewBox="0 0 24 24"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg> <span data-i18n="settings.switchAccount">Switch Account</span>
                    </button>
                    <button class="btn-secondary" id="btn-change-server">
                      <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg> <span data-i18n="settings.changeServer">Change Server</span>
                    </button>
                    <button class="btn-danger-outline" id="btn-logout">
                      <svg viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg> <span data-i18n="settings.logout">Logout</span>
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- Conversation Settings Section -->
              <div class="settings-section" id="settings-conversation">
                <div class="settings-section-header">
                  <h3 data-i18n="settings.conversationSettings">Conversation Settings</h3>
                </div>
                
                <!-- Permission mode -->
                <div class="setting-item">
                  <label data-i18n="settings.permissionMode">Permission Mode</label>
                  <select id="happy-permission-mode">
                    <option value="default" data-i18n="settings.permissionDefault">Default (default)</option>
                    <option value="acceptEdits" data-i18n="settings.permissionAcceptEdits">Accept Edits (acceptEdits)</option>
                    <option value="plan" data-i18n="settings.permissionPlan">Plan Mode (plan)</option>
                    <option value="bypassPermissions" data-i18n="settings.permissionYolo">YOLO (bypassPermissions)</option>
                  </select>
                  <p class="setting-hint" id="permission-mode-hint" data-i18n="settings.permissionHintDefault">Default mode: Requires confirmation for each operation</p>
                </div>
                
                <!-- Working directory -->
                <div class="setting-item">
                  <label data-i18n="settings.currentWorkDir">Current Working Directory</label>
                  <div class="workspace-path-container">
                    <input type="text" id="workspace-dir" readonly data-i18n-placeholder="common.loading" placeholder="Loading...">
                    <button id="btn-select-workspace" class="btn-icon" data-i18n-title="settings.selectDir" title="Select Directory">
                      <svg viewBox="0 0 24 24"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/></svg>
                    </button>
                    <button id="btn-reset-workspace" class="btn-icon" data-i18n-title="settings.resetDefault" title="Reset to Default">
                      <svg viewBox="0 0 24 24"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                    </button>
                  </div>
                </div>
                <div class="setting-item">
                  <label data-i18n="settings.defaultDir">Default Directory</label>
                  <input type="text" id="default-workspace-dir" readonly class="muted">
                </div>
              </div>
              
              <!-- Appearance Settings Section -->
              <div class="settings-section" id="settings-appearance">
                <div class="settings-section-header">
                  <h3 data-i18n="settings.appearance">Appearance</h3>
                </div>
                <div class="setting-item setting-item-row">
                  <label data-i18n="settings.language">Language</label>
                  <select id="language-select">
                    <option value="en-US">English</option>
                    <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                  </select>
                </div>
                <div class="setting-item setting-item-row">
                  <label data-i18n="settings.themeMode">Theme Mode</label>
                  <select id="theme-mode" disabled>
                    <!-- æš‚æ—¶éšè—: ä»…ä½¿ç”¨æ·±è‰²æ¨¡å¼
                    <option value="system" data-i18n="settings.themeSystem">Follow System</option>
                    <option value="light" data-i18n="settings.themeLight">Light</option>
                    -->
                    <option value="dark" data-i18n="settings.themeDark" selected>Dark</option>
                  </select>
                </div>
                <p class="setting-hint" id="theme-hint" data-i18n="settings.themeHint">Current: Follow system preference</p>
              </div>
              
              <!-- Server Settings Section -->
              <div class="settings-section" id="settings-server">
                <div class="settings-section-header">
                  <h3 data-i18n="settings.serverSettings">Server Settings</h3>
                </div>
                <div class="setting-item">
                  <label data-i18n="settings.httpPort">HTTP Port</label>
                  <input type="number" id="http-port" value="3333" readonly>
                </div>
                <div class="setting-item">
                  <label data-i18n="settings.wsPort">WebSocket Port</label>
                  <input type="number" id="ws-port" value="8080" readonly>
                </div>
                <div class="setting-item">
                  <label data-i18n="settings.serverActions">Server Actions</label>
                  <button id="btn-restart-server" class="btn-secondary" data-i18n="settings.restartServer">Restart Server</button>
                </div>
                
                <!-- Restart control -->
                <div class="restart-section-inline" id="restart-section" style="display: none;">
                  <div class="restart-prompt">
                    <span data-i18n="settings.restartRequired">Some settings require a restart to take effect</span>
                    <div class="restart-buttons">
                      <button id="btn-restart-now" class="btn-primary" data-i18n="settings.restartNow">Restart Now</button>
                      <button id="btn-restart-later" class="btn-secondary" data-i18n="settings.restartLater">Restart Later</button>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Logs Section -->
              <div class="settings-section" id="settings-logs">
                <div class="settings-section-header">
                  <h3>
                    <span data-i18n="settings.logs">Logs</span>
                    <button id="clear-logs-btn" class="btn-icon-sm" data-i18n-title="settings.clearLogs" title="Clear Logs"><svg viewBox="0 0 24 24" width="14" height="14"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg></button>
                  </h3>
                </div>
                <div id="logs-container-inline">
                  <div id="logs-list"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
      
      <!-- Session Hub Panel (floating overlay) -->
      <aside id="session-hub-panel" class="session-hub-panel" style="display: none;">
        <div class="session-hub-header">
          <h3 data-i18n="sessionHub.title">Session Hub</h3>
          <button id="session-hub-close-btn" class="session-hub-close" data-i18n-title="common.close" title="Close">&times;</button>
        </div>
        <div class="session-hub-actions">
          <button id="session-hub-new-dir-btn" class="session-hub-new-dir-btn" data-i18n-title="sessionHub.switchDir" title="Switch to new working directory">
            <svg viewBox="0 0 24 24"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/><line x1="12" x2="12" y1="10" y2="16"/><line x1="9" x2="15" y1="13" y2="13"/></svg>
            <span data-i18n="sessionHub.switchDir">Switch to new directory</span>
          </button>
        </div>
        <div class="session-hub-list" id="session-hub-list">
          <!-- Session cards will be rendered dynamically -->
        </div>
      </aside>
    </div>
    
    <!-- Status bar (simplified) -->
    <footer id="status-bar">
      <div id="status-left">
        <span id="server-status" class="status-item" data-i18n-title="status.serviceTitle" title="Service Status">
          <span class="status-label" data-i18n="status.service">Service</span>
          <span class="status-dot state-starting" id="server-status-dot"></span>
          <span class="status-value" id="server-status-value" data-i18n="status.starting">Starting</span>
        </span>
        <span class="info-divider">|</span>
        <span id="agent-status" class="status-item" data-i18n-title="chat.agentStatus" title="Agent Status">
          <span class="status-label" data-i18n="status.agent">Agent</span>
          <span class="status-dot state-idle" id="happy-event-dot"></span>
          <span class="status-value" id="happy-event-text">idle</span>
        </span>
      </div>
      <div id="status-right">
        <span id="workspace-status" class="status-item status-clickable" data-i18n-title="status.workDirTooltip" title="Click to modify working directory">
          <span class="status-icon"><svg viewBox="0 0 24 24" width="12" height="12"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/></svg></span>
          <span class="status-value status-path" id="status-workspace-path">-</span>
        </span>
      </div>
    </footer>
    
    <!-- Setup wizard overlay -->
    <div id="setup-wizard-overlay" class="wizard-overlay" style="display: none;">
      <div class="wizard-container">
        <!-- Wizard header -->
        <div class="wizard-header">
          <h2 class="wizard-title" data-i18n="wizard.title">Environment Setup Wizard</h2>
          <p class="wizard-subtitle" data-i18n="wizard.subtitle">Complete the following configuration to get started</p>
        </div>
        
        <!-- Step indicator -->
        <div class="wizard-steps">
          <div class="wizard-step active" data-step="1">
            <span class="step-number">1</span>
            <span class="step-label" data-i18n="wizard.step1">Environment Check</span>
          </div>
          <div class="wizard-step" data-step="2">
            <span class="step-number">2</span>
            <span class="step-label" data-i18n="wizard.step2">Install Dependencies</span>
          </div>
          <div class="wizard-step" data-step="3">
            <span class="step-number">3</span>
            <span class="step-label" data-i18n="wizard.step3">API Configuration</span>
          </div>
          <div class="wizard-step" data-step="4">
            <span class="step-number">4</span>
            <span class="step-label" data-i18n="wizard.step4">Browser Extension</span>
          </div>
          <div class="wizard-step" data-step="5">
            <span class="step-number">5</span>
            <span class="step-label" data-i18n="wizard.step5">Complete</span>
          </div>
        </div>
        
        <!-- Step content area -->
        <div class="wizard-content">
          <!-- Step 1: Environment overview -->
          <div class="wizard-step-content active" data-step="1">
            <div class="step-header">
              <h3 data-i18n="wizard.envCheckTitle">Environment Check Results</h3>
              <p data-i18n="wizard.envCheckDesc">The following are the current environment check results</p>
            </div>
            <div class="requirements-list" id="requirements-list">
              <!-- Dynamically generated -->
            </div>
            <div class="step-actions">
              <button class="btn-secondary" id="wizard-skip-btn" data-i18n="wizard.skipConfig">Configure Later</button>
              <button class="btn-primary" id="wizard-start-btn" data-i18n="wizard.startConfig">Start Configuration</button>
            </div>
          </div>
          
          <!-- Step 2: Claude Code installation guide -->
          <div class="wizard-step-content" data-step="2">
            <div class="step-header">
              <h3 data-i18n="wizard.installClaudeTitle">Install Claude Code</h3>
              <p data-i18n="wizard.installClaudeDesc">Claude Code is a required DeepSeek Cowork component</p>
            </div>
            <div class="install-guide">
              <div class="install-status" id="claude-install-status">
                <span class="status-icon"><svg viewBox="0 0 24 24" width="24" height="24" class="icon-loader"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg></span>
                <span class="status-text" data-i18n="settings.checking">Checking...</span>
              </div>
              <div class="install-methods" id="claude-install-methods">
                <!-- Dynamically generated installation methods -->
              </div>
              <div class="install-command-box" id="claude-install-command">
                <code id="claude-command-text"></code>
                <button class="btn-copy" id="copy-command-btn" data-i18n-title="common.copy" title="Copy">
                  <svg viewBox="0 0 24 24"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                </button>
              </div>
              <div class="install-links">
                <button class="btn-link" id="open-claude-docs-btn">
                  <svg viewBox="0 0 24 24" width="14" height="14" style="display:inline;vertical-align:middle;margin-right:4px;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;fill:none;"><path d="M12 7v14"/><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/></svg> <span data-i18n="wizard.viewDocs">View Official Documentation</span>
                </button>
              </div>
            </div>
            <div class="step-actions">
              <button class="btn-secondary" id="wizard-prev-2" data-i18n="common.previous">Previous</button>
              <button class="btn-secondary" id="wizard-recheck-2" data-i18n="wizard.recheck">Re-check</button>
              <button class="btn-primary" id="wizard-next-2" disabled data-i18n="common.next">Next</button>
            </div>
          </div>
          
          <!-- Step 3: API Key configuration -->
          <div class="wizard-step-content" data-step="3">
            <div class="step-header">
              <h3 data-i18n="wizard.apiConfigTitle">Configure API Key</h3>
              <p data-i18n="wizard.apiConfigDesc">Select API provider and enter your API Key</p>
            </div>
            <div class="api-config-form">
              <div class="form-group">
                <label for="wizard-provider" data-i18n="wizard.apiProviderLabel">API Provider</label>
                <select id="wizard-provider" class="form-select">
                  <option value="deepseek">DeepSeek</option>
                  <option value="anthropic" data-i18n="settings.providerAnthropic">Anthropic (Official)</option>
                  <option value="custom" data-i18n="settings.providerCustom">Custom</option>
                </select>
              </div>
              <div class="form-group" id="wizard-baseurl-group" style="display: none;">
                <label for="wizard-baseurl" data-i18n="wizard.apiEndpointLabel">API Endpoint</label>
                <input type="text" id="wizard-baseurl" class="form-input" placeholder="https://api.deepseek.com/anthropic">
              </div>
              <div class="form-group">
                <label for="wizard-api-key" data-i18n="wizard.apiKeyLabel">API Key</label>
                <div class="input-with-action">
                  <input type="password" id="wizard-api-key" class="form-input" data-i18n-placeholder="wizard.apiKeyPlaceholder" placeholder="Enter your API Key...">
                  <button class="btn-icon" id="toggle-api-key-btn" data-i18n-title="settings.showHide" title="Show/Hide">
                    <svg viewBox="0 0 24 24"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg>
                  </button>
                </div>
                <p class="form-hint" id="wizard-api-hint" data-i18n="wizard.apiKeyHint">Please enter your DeepSeek API Key</p>
              </div>
              <div class="form-group" id="wizard-model-group" style="display: none;">
                <label for="wizard-model" data-i18n="wizard.modelNameLabel">Model Name</label>
                <input type="text" id="wizard-model" class="form-input" placeholder="deepseek-chat">
              </div>
              <p class="api-config-status" id="wizard-api-status"></p>
            </div>
            <div class="step-actions">
              <button class="btn-secondary" id="wizard-prev-3" data-i18n="common.previous">Previous</button>
              <button class="btn-primary" id="wizard-save-api" data-i18n="wizard.saveConfig">Save Configuration</button>
            </div>
          </div>
          
          <!-- Step 4: JS-EYES Browser Extension -->
          <div class="wizard-step-content" data-step="4">
            <div class="step-header">
              <h3 data-i18n="wizard.installJsEyesTitle">Install JS-EYES Browser Extension</h3>
              <p data-i18n="wizard.installJsEyesDesc">JS-EYES enables browser automation features (optional)</p>
            </div>
            <div class="install-guide">
              <div class="install-status optional">
                <span class="status-icon">
                  <svg viewBox="0 0 24 24" width="24" height="24" style="stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;fill:none;">
                    <circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>
                  </svg>
                </span>
                <span class="status-text" data-i18n="wizard.jsEyesOptionalHint">This step is optional, you can skip it</span>
              </div>
              <div class="jseyes-features">
                <p data-i18n="wizard.jsEyesFeatures">Features: Tab control, script execution, data extraction</p>
              </div>
              <div class="install-steps-list">
                <h4 data-i18n="wizard.jsEyesInstallSteps">Installation Steps</h4>
                <ol class="numbered-steps">
                  <li data-i18n="wizard.jsEyesStep1">Download the project from GitHub</li>
                  <li data-i18n="wizard.jsEyesStep2">Open Chrome extensions page (chrome://extensions)</li>
                  <li data-i18n="wizard.jsEyesStep3">Enable Developer Mode</li>
                  <li data-i18n="wizard.jsEyesStep4">Click "Load unpacked"</li>
                  <li data-i18n="wizard.jsEyesStep5">Select the downloaded js-eyes directory</li>
                </ol>
              </div>
              <div class="install-links">
                <button class="btn-primary" id="open-jseyes-github-btn">
                  <svg viewBox="0 0 24 24" width="14" height="14" style="display:inline;vertical-align:middle;margin-right:4px;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;fill:none;"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
                  <span data-i18n="wizard.openGithub">Open GitHub</span>
                </button>
              </div>
            </div>
            <div class="step-actions">
              <button class="btn-secondary" id="wizard-prev-4" data-i18n="common.previous">Previous</button>
              <button class="btn-secondary" id="wizard-skip-4" data-i18n="common.skip">Skip</button>
              <button class="btn-primary" id="wizard-next-4" data-i18n="common.next">Next</button>
            </div>
          </div>
          
          <!-- Step 5: Complete -->
          <div class="wizard-step-content" data-step="5">
            <div class="step-header complete-header">
              <div class="complete-icon"><svg viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg></div>
              <h3 data-i18n="wizard.completeTitle">Configuration Complete</h3>
              <p data-i18n="wizard.completeDesc">You have completed all necessary configurations and can start using</p>
            </div>
            <div class="config-summary" id="config-summary">
              <!-- Dynamically generated config summary -->
            </div>
            <div class="step-actions center">
              <button class="btn-primary btn-large" id="wizard-complete-btn" data-i18n="wizard.startUsingBtn">Start Using</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Markdown rendering and code highlighting -->
  <script src="js/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>
    // Initialize Marked configuration
    if (typeof marked !== 'undefined') {
      marked.setOptions({
        breaks: true,
        gfm: true,
        headerIds: false,
        mangle: false,
        highlight: function(code, lang) {
          if (typeof hljs !== 'undefined' && lang && hljs.getLanguage(lang)) {
            try {
              return hljs.highlight(code, { language: lang }).value;
            } catch (e) {
              console.warn('Code highlight failed:', e);
            }
          }
          return code;
        }
      });
      console.log('Marked renderer initialized');
    }
  </script>
  <!-- Core modules -->
  <script src="js/core/ThemeManager.js"></script>
  <script src="js/core/ModelConfig.js"></script>
  <script src="js/core/WindowController.js"></script>
  <script src="js/core/ApiAdapter.js"></script>
  <script src="js/core/WebSocketClient.js"></script>
  
  <!-- Components -->
  <script src="js/components/NotificationManager.js"></script>
  <script src="js/components/DialogManager.js"></script>
  <script src="js/components/LogViewer.js"></script>
  <script src="js/components/ConnectionGuide.js"></script>
  
  <!-- i18n Internationalization -->
  <script src="js/i18n/index.js"></script>
  <script src="js/i18n/locales/en-US.js"></script>
  <script src="js/i18n/locales/zh-CN.js"></script>
  <script>
    // Initialize i18n before app loads
    if (typeof I18nManager !== 'undefined') {
      I18nManager.init();
    }
  </script>
  <!-- Features - Explorer -->
  <script src="js/features/explorer/services/ExplorerClient.js"></script>
  <script src="js/features/explorer/services/ExplorerSSE.js"></script>
  <script src="js/features/explorer/services/ExplorerManager.js"></script>
  <script src="js/features/explorer/ExplorerModule.js"></script>
  <script src="js/features/explorer/PreviewBackground.js"></script>
  
  <!-- Sync - Message Processing (Reducer Architecture) -->
  <script src="js/sync/types.js"></script>
  <script src="js/sync/normalizer.js"></script>
  <script src="js/sync/reducer.js"></script>
  
  <!-- Utils -->
  <script src="js/utils/optionsParser.js"></script>
  
  <!-- Features - Command Suggestions -->
  <script src="js/features/command-suggestions/index.js"></script>
  
  <!-- Features - HappyAI -->
  <script src="js/features/happy-ai/HappyMessageHandler.js"></script>
  <script src="js/features/happy-ai/ToolCallRenderer.js"></script>
  <script src="js/features/happy-ai/UsageDisplay.js"></script>
  
  <!-- Features - FilePreview (å·²ç§»é™¤ï¼ŒåŠŸèƒ½å·²è¢« ExplorerModule æ›¿ä»£) -->
  
  <!-- Features - Settings -->
  <script src="js/features/settings/DaemonManager.js"></script>
  <script src="js/features/settings/WorkspaceSettings.js"></script>
  <script src="js/features/settings/ClaudeCodeSettings.js"></script>
  <script src="js/features/settings/DependencyChecker.js"></script>
  
  <!-- Features - SessionHub -->
  <script src="js/features/session-hub/SessionHub.js"></script>
  
  <!-- Features - MobileDrawer -->
  <script src="js/features/mobile-drawer/MobileDrawer.js"></script>
  
  <!-- Features - BrowserControl -->
  <script src="js/features/browser/services/ExtensionService.js"></script>
  <script src="js/features/browser/services/ServerService.js"></script>
  <script src="js/features/browser/BrowserControlModule.js"></script>
  
  <!-- Panels -->
  <script src="js/panels/ChatPanel.js"></script>
  <script src="js/panels/FilesPanel.js"></script>
  <script src="js/panels/BrowserPanel.js"></script>
  <script src="js/panels/SettingsPanel.js"></script>
  
  <!-- Wizards -->
  <script src="js/wizards/SetupWizard.js"></script>
  <script src="js/wizards/AccountSetup.js"></script>
  
  <script src="js/app.js"></script>
  
  <!-- Initialize ApiAdapter and ConnectionGuide for Web mode (after all scripts loaded) -->
  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      // Initialize ApiAdapter
      if (typeof ApiAdapter !== 'undefined' && window.apiAdapter) {
        try {
          const result = await window.apiAdapter.initialize();
          console.log('[Init] ApiAdapter initialized:', result);
          
          // Initialize ConnectionGuide (only shows in Web mode when disconnected)
          if (typeof ConnectionGuide !== 'undefined') {
            window.connectionGuide = new ConnectionGuide();
            await window.connectionGuide.initialize();
            console.log('[Init] ConnectionGuide initialized');
          }
        } catch (error) {
          console.error('[Init] ApiAdapter initialization failed:', error);
        }
      }
    });
  </script>
  
  <!-- å…¨å±åŠ è½½é®ç½© -->
  <div id="global-loading-overlay" class="global-loading-overlay hidden">
    <div class="loading-spinner"></div>
    <p class="loading-text" data-i18n="common.loading">Loading...</p>
  </div>
</body>
</html>
